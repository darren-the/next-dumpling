import Head from 'next/head'
import { getContent, splitContentByType } from '../modules/contentful/content'
import Link from 'next/link'
import LargeCard from '../components/cards/large-card'
import Header from '../components/header'
import SmallCard from '../components/cards/small-card'

const Index = ({ contentJSON }) => {
  const { news, interviews } = JSON.parse(contentJSON)

  // Create large news card
  const largeNewsCard = (news && news.length > 0) ? (
    <Link href={`/news/${news[0]['content-id']}`}>
      <a><LargeCard content={news[0]} borderBottom={true} /></a>
    </Link>
  ) : null

  // Create small news cards
  const smallNewsCards = (news && news.length > 1) ? news.slice(1).map((item) =>
  <Link href={`/news/${item['content-id']}`}>
    <a><SmallCard content={item} /></a>
  </Link>
  ) : null
    

  return (
    <div>
      <Head>
        <title>My app</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      
      <div className="flex justify-center p-8">
        <div className="w-full grid grid-areas-home">

          <div className="grid-in-news flex flex-col max-w-[700px] mr-4">
            <Header contentType="news" />
            {largeNewsCard}
            {smallNewsCards}
          </div>

          <div className="grid-in-interviews">
            Interviews placeholder
          </div>

          <div className='grid-in-rss'>
            RSS placeholder
          </div>
          
        </div>
      </div>
    </div>
  )
}

export const getStaticProps = async () => {
  const content = await getContent()
  const splitContent = splitContentByType(content)
  const contentJSON = JSON.stringify(splitContent)
  return {
    props: { contentJSON },
  }
}

export default Index